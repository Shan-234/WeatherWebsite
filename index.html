<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>My Starter HTML Page</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
        <style>
            /* Add your CSS styles here */
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f0f0f0;
            }
            header {
                background-color: #007BFF;
                color: white;
                padding: 1rem;
                text-align: center;
            }
            main {
                padding: 2rem;
            }
            footer {
                background-color: #007BFF;
                color: white;
                text-align: center;
                padding: 1rem;
                position: fixed;
                width: 100%;
                bottom: 0;
            }
            #map-container {
                display: flex;
                justify-content: center; /* Center horizontally */
            }
            #map {
                height: 400px;
                width: 100%; /* Set a specific width */
                max-width: 800px; /* Optional: Max width for larger screens */
                margin: auto; /* Center the map horizontally */
            }
        </style>
    </head>
    <body>

        <header>
            <h1>Weather Website</h1>
        </header>

        <div id="map-container">
            <div id="map"></div>
        </div>

        <div>
            <h1>Today's Weather</h1>
            <label for="searchCity">Search By City</label>
            <input id="searchCity" type="text" name="searchCity">
            <button id="searchButton" onclick="search()">SEARCH</button>
        </div>

        <div>
            <h3 id="city"></h3>
            <h3 id="min_temp"></h3>
            <h3 id="max_temp"></h3>
        </div>
    </body>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
  
        let map = L.map('map').setView([20, 20], 2);

        // Add the OpenStreetMap tiles to the map
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        map.on('click', function(event) {
            const apiKey = 'AIzaSyCGbGqGj08Q-flsrNm4tTORRr4Krk1jebg';
            const lat = event.latlng.lat;
            const lng = event.latlng.lng;
            const url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + lat + ',' + lng + '&key=' + apiKey;

            fetch(url).then(response => {
                if (response.ok) {
                    return response.json();
                }

                throw new Error('Request failed!');
            }, networkError => console.log(networkError.message)).then(jsonResponse => {
                console.log(jsonResponse);
            });
        });

        const search = () => {
            const city = document.getElementById("searchCity").value;
            fetch('http://dataservice.accuweather.com/locations/v1/cities/search?apikey=ohcWJbAu7v1CeoUXpJQmX7hndBq2ASnt&q=' + city).then(response => {
                if (response.ok) {
                    return response.json();
                }

                throw new Error('Request failed!');
            }, networkError => console.log(networkError.message)).then(jsonResponse1 => {
                console.log(jsonResponse1);
                const locationKey = jsonResponse1[0].Key;
                const url = 'http://dataservice.accuweather.com/forecasts/v1/daily/1day/' + locationKey + '?apikey=ohcWJbAu7v1CeoUXpJQmX7hndBq2ASnt';

                fetch(url).then(response => {
                    if (response.ok) {
                        return response.json();
                    }

                    throw new Error('Request failed!');
                }, networkError => console.log(networkError.message)).then(jsonResponse2 => {
                    console.log(jsonResponse2);
                    const cityName = jsonResponse1[0].EnglishName;
                    const countryName = jsonResponse1[0].Country.EnglishName;
                    document.getElementById("city").textContent = "City: " + cityName + ", " + countryName;

                    const forecasts = jsonResponse2.DailyForecasts;
                    const data = forecasts[0];
                    let minTemp = convertToCelsius(data.Temperature.Minimum.Value);
                    let maxTemp = convertToCelsius(data.Temperature.Maximum.Value);

                    document.getElementById("min_temp").textContent = "Minimum Temperature: " + minTemp + "°C";
                    document.getElementById("max_temp").textContent = "Maximum Temperature: " + maxTemp + "°C";
                });
            });
        };

        const convertToCelsius = (temp) => {
            return Math.floor((temp - 32) * 5 / 9);
        };

    </script>
</html>